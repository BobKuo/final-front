import{P as ne,ad as se,ae as de,g as oe,af as me,c as i,r as M,w as ve,ag as ee,ah as fe,K as ie,h as Q,a5 as re,a7 as W,ai as ge,aj as ye,ak as be,al as he,am as Se,an as xe,ao as ke,ap as _e,J as Ce,Q as Ve,aq as Pe,M as p,a2 as Ae,a3 as ue,t as Le,z as j,m as V,B as h,f as g,ar as X,l as H,F as G,A as J,q as C,u as I,as as te,p as we,a9 as K,at as $e,au as qe,a4 as Be,av as Ie,I as Qe}from"./index-D1ygRcZh.js";import{Q as Me,a as Fe}from"./QMenu-lIu7vw0y.js";import{Q as De,a as Ee,b as Ne}from"./QList-Brw5UsWA.js";import{b as ce}from"./format-BvkBI9bc.js";import{Q as je}from"./QPage-D085TDxR.js";import{p as He}from"./product-BgKl9zfA.js";import{Q as Oe,a as Te}from"./QCarousel-COywyrPl.js";import{Q as Ue}from"./QImg-DwNgSzg-.js";import{Q as ae}from"./QBadge-DUZrlC0E.js";import"./selection-B1a98VF1.js";import"./touch-BjYP5sR0.js";import"./use-fullscreen-CML9RU_w.js";function R(e,m){return[!0,!1].includes(e)?e:m}const ze=ne({name:"QPagination",props:{...de,modelValue:{type:Number,required:!0},min:{type:[Number,String],default:1},max:{type:[Number,String],required:!0},maxPages:{type:[Number,String],default:0,validator:e=>(typeof e=="string"?parseInt(e,10):e)>=0},inputStyle:[Array,String,Object],inputClass:[Array,String,Object],size:String,disable:Boolean,input:Boolean,iconPrev:String,iconNext:String,iconFirst:String,iconLast:String,toFn:Function,boundaryLinks:{type:Boolean,default:null},boundaryNumbers:{type:Boolean,default:null},directionLinks:{type:Boolean,default:null},ellipses:{type:Boolean,default:null},ripple:{type:[Boolean,Object],default:null},round:Boolean,rounded:Boolean,flat:Boolean,outline:Boolean,unelevated:Boolean,push:Boolean,glossy:Boolean,color:{type:String,default:"primary"},textColor:String,activeDesign:{type:String,default:"",values:e=>e===""||se.includes(e)},activeColor:String,activeTextColor:String,gutter:String,padding:{type:String,default:"3px 2px"}},emits:["update:modelValue"],setup(e,{emit:m}){const{proxy:f}=oe(),{$q:s}=f,S=me(e,s),v=i(()=>parseInt(e.min,10)),u=i(()=>parseInt(e.max,10)),d=i(()=>parseInt(e.maxPages,10)),x=i(()=>c.value+" / "+u.value),k=i(()=>R(e.boundaryLinks,e.input)),y=i(()=>R(e.boundaryNumbers,!e.input)),O=i(()=>R(e.directionLinks,e.input)),F=i(()=>R(e.ellipses,!e.input)),D=M(null),c=i({get:()=>e.modelValue,set:l=>{if(l=parseInt(l,10),e.disable||isNaN(l))return;const o=ce(l,v.value,u.value);e.modelValue!==o&&m("update:modelValue",o)}});ve(()=>`${v.value}|${u.value}`,()=>{c.value=e.modelValue});const b=i(()=>"q-pagination row no-wrap items-center"+(e.disable===!0?" disabled":"")),r=i(()=>e.gutter in ee?`${ee[e.gutter]}px`:e.gutter||null),A=i(()=>r.value!==null?`--q-pagination-gutter-parent:-${r.value};--q-pagination-gutter-child:${r.value}`:null),L=i(()=>{const l=[e.iconFirst||s.iconSet.pagination.first,e.iconPrev||s.iconSet.pagination.prev,e.iconNext||s.iconSet.pagination.next,e.iconLast||s.iconSet.pagination.last];return s.lang.rtl===!0?l.reverse():l}),n=i(()=>({"aria-disabled":e.disable===!0?"true":"false",role:"navigation"})),a=i(()=>fe(e,"flat")),_=i(()=>({[a.value]:!0,round:e.round,rounded:e.rounded,padding:e.padding,color:e.color,textColor:e.textColor,size:e.size,ripple:e.ripple!==null?e.ripple:!0})),q=i(()=>{const l={[a.value]:!1};return e.activeDesign!==""&&(l[e.activeDesign]=!0),l}),B=i(()=>({...q.value,color:e.activeColor||e.color,textColor:e.activeTextColor||e.textColor})),t=i(()=>{let l=Math.max(d.value,1+(F.value?2:0)+(y.value?2:0));const o={pgFrom:v.value,pgTo:u.value,ellipsesStart:!1,ellipsesEnd:!1,boundaryStart:!1,boundaryEnd:!1,marginalStyle:{minWidth:`${Math.max(2,String(u.value).length)}em`}};return d.value&&l<u.value-v.value+1&&(l=1+Math.floor(l/2)*2,o.pgFrom=Math.max(v.value,Math.min(u.value-l+1,e.modelValue-Math.floor(l/2))),o.pgTo=Math.min(u.value,o.pgFrom+l-1),y.value&&(o.boundaryStart=!0,o.pgFrom++),F.value&&o.pgFrom>v.value+(y.value?1:0)&&(o.ellipsesStart=!0,o.pgFrom++),y.value&&(o.boundaryEnd=!0,o.pgTo--),F.value&&o.pgTo<u.value-(y.value?1:0)&&(o.ellipsesEnd=!0,o.pgTo--)),o});function w(l){c.value=l}function E(l){c.value=c.value+l}const T=i(()=>{function l(){c.value=D.value,D.value=null}return{"onUpdate:modelValue":o=>{D.value=o},onKeyup:o=>{ie(o,13)===!0&&l()},onBlur:l}});function P(l,o,U){const N={"aria-label":o,"aria-current":"false",..._.value,...l};return U===!0&&Object.assign(N,{"aria-current":"true",...B.value}),o!==void 0&&(e.toFn!==void 0?N.to=e.toFn(o):N.onClick=()=>{w(o)}),Q(W,N)}return Object.assign(f,{set:w,setByOffset:E}),()=>{const l=[],o=[];let U;if(k.value===!0&&(l.push(P({key:"bls",disable:e.disable||e.modelValue<=v.value,icon:L.value[0],"aria-label":s.lang.pagination.first},v.value)),o.unshift(P({key:"ble",disable:e.disable||e.modelValue>=u.value,icon:L.value[3],"aria-label":s.lang.pagination.last},u.value))),O.value===!0&&(l.push(P({key:"bdp",disable:e.disable||e.modelValue<=v.value,icon:L.value[1],"aria-label":s.lang.pagination.prev},e.modelValue-1)),o.unshift(P({key:"bdn",disable:e.disable||e.modelValue>=u.value,icon:L.value[2],"aria-label":s.lang.pagination.next},e.modelValue+1))),e.input!==!0){U=[];const{pgFrom:N,pgTo:Z,marginalStyle:z}=t.value;if(t.value.boundaryStart===!0){const $=v.value===e.modelValue;l.push(P({key:"bns",style:z,disable:e.disable,label:v.value},v.value,$))}if(t.value.boundaryEnd===!0){const $=u.value===e.modelValue;o.unshift(P({key:"bne",style:z,disable:e.disable,label:u.value},u.value,$))}t.value.ellipsesStart===!0&&l.push(P({key:"bes",style:z,disable:e.disable,label:"…",ripple:!1},N-1)),t.value.ellipsesEnd===!0&&o.unshift(P({key:"bee",style:z,disable:e.disable,label:"…",ripple:!1},Z+1));for(let $=N;$<=Z;$++)U.push(P({key:`bpg${$}`,style:z,disable:e.disable,label:$},$,$===e.modelValue))}return Q("div",{class:b.value,...n.value},[Q("div",{class:"q-pagination__content row no-wrap items-center",style:A.value},[...l,e.input===!0?Q(re,{class:"inline",style:{width:`${x.value.length/1.5}em`},type:"number",dense:!0,value:D.value,disable:e.disable,dark:S.value,borderless:!0,inputClass:e.inputClass,inputStyle:e.inputStyle,placeholder:x.value,min:v.value,max:u.value,...T.value}):Q("div",{class:"q-pagination__middle row justify-center"},U),...o])])}}});function le(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const m=parseInt(e,10);return isNaN(m)?0:m}const Ke=ge({name:"close-popup",beforeMount(e,{value:m}){const f={depth:le(m),handler(s){f.depth!==0&&setTimeout(()=>{const S=ye(e);S!==void 0&&be(S,s,f.depth)})},handlerKey(s){ie(s,13)===!0&&f.handler(s)}};e.__qclosepopup=f,e.addEventListener("click",f.handler),e.addEventListener("keyup",f.handlerKey)},updated(e,{value:m,oldValue:f}){m!==f&&(e.__qclosepopup.depth=le(m))},beforeUnmount(e){const m=e.__qclosepopup;e.removeEventListener("click",m.handler),e.removeEventListener("keyup",m.handlerKey),delete e.__qclosepopup}}),Re=ne({name:"QRating",props:{...Se,...he,modelValue:{type:Number,required:!0},max:{type:[String,Number],default:5},icon:[String,Array],iconHalf:[String,Array],iconSelected:[String,Array],iconAriaLabel:[String,Array],color:[String,Array],colorHalf:[String,Array],colorSelected:[String,Array],noReset:Boolean,noDimming:Boolean,readonly:Boolean,disable:Boolean},emits:["update:modelValue"],setup(e,{slots:m,emit:f}){const{proxy:{$q:s}}=oe(),S=xe(e),v=ke(e),u=Pe(v),d=M(0);let x={};const k=i(()=>e.readonly!==!0&&e.disable!==!0),y=i(()=>`q-rating row inline items-center q-rating--${k.value===!0?"":"non-"}editable`+(e.noDimming===!0?" q-rating--no-dimming":"")+(e.disable===!0?" disabled":"")+(e.color!==void 0&&Array.isArray(e.color)===!1?` text-${e.color}`:"")),O=i(()=>{const n=Array.isArray(e.icon)===!0?e.icon.length:0,a=Array.isArray(e.iconSelected)===!0?e.iconSelected.length:0,_=Array.isArray(e.iconHalf)===!0?e.iconHalf.length:0,q=Array.isArray(e.color)===!0?e.color.length:0,B=Array.isArray(e.colorSelected)===!0?e.colorSelected.length:0,t=Array.isArray(e.colorHalf)===!0?e.colorHalf.length:0;return{iconLen:n,icon:n>0?e.icon[n-1]:e.icon,selIconLen:a,selIcon:a>0?e.iconSelected[a-1]:e.iconSelected,halfIconLen:_,halfIcon:_>0?e.iconHalf[a-1]:e.iconHalf,colorLen:q,color:q>0?e.color[q-1]:e.color,selColorLen:B,selColor:B>0?e.colorSelected[B-1]:e.colorSelected,halfColorLen:t,halfColor:t>0?e.colorHalf[t-1]:e.colorHalf}}),F=i(()=>{if(typeof e.iconAriaLabel=="string"){const n=e.iconAriaLabel.length!==0?`${e.iconAriaLabel} `:"";return a=>`${n}${a}`}if(Array.isArray(e.iconAriaLabel)===!0){const n=e.iconAriaLabel.length;if(n>0)return a=>e.iconAriaLabel[Math.min(a,n)-1]}return(n,a)=>`${a} ${n}`}),D=i(()=>{const n=[],a=O.value,_=Math.ceil(e.modelValue),q=k.value===!0?0:null,B=e.iconHalf===void 0||_===e.modelValue?-1:_;for(let t=1;t<=e.max;t++){const w=d.value===0&&e.modelValue>=t||d.value>0&&d.value>=t,E=B===t&&d.value<t,T=d.value>0&&(E===!0?_:e.modelValue)>=t&&d.value<t,P=E===!0?t<=a.halfColorLen?e.colorHalf[t-1]:a.halfColor:a.selColor!==void 0&&w===!0?t<=a.selColorLen?e.colorSelected[t-1]:a.selColor:t<=a.colorLen?e.color[t-1]:a.color,l=(E===!0?t<=a.halfIconLen?e.iconHalf[t-1]:a.halfIcon:a.selIcon!==void 0&&(w===!0||T===!0)?t<=a.selIconLen?e.iconSelected[t-1]:a.selIcon:t<=a.iconLen?e.icon[t-1]:a.icon)||s.iconSet.rating.icon;n.push({name:(E===!0?t<=a.halfIconLen?e.iconHalf[t-1]:a.halfIcon:a.selIcon!==void 0&&(w===!0||T===!0)?t<=a.selIconLen?e.iconSelected[t-1]:a.selIcon:t<=a.iconLen?e.icon[t-1]:a.icon)||s.iconSet.rating.icon,attrs:{tabindex:q,role:"radio","aria-checked":e.modelValue===t?"true":"false","aria-label":F.value(t,l)},iconClass:"q-rating__icon"+(w===!0||E===!0?" q-rating__icon--active":"")+(T===!0?" q-rating__icon--exselected":"")+(d.value===t?" q-rating__icon--hovered":"")+(P!==void 0?` text-${P}`:"")})}return n}),c=i(()=>{const n={role:"radiogroup"};return e.disable===!0&&(n["aria-disabled"]="true"),e.readonly===!0&&(n["aria-readonly"]="true"),n});function b(n){if(k.value===!0){const a=ce(parseInt(n,10),1,parseInt(e.max,10)),_=e.noReset!==!0&&e.modelValue===a?0:a;_!==e.modelValue&&f("update:modelValue",_),d.value=0}}function r(n){k.value===!0&&(d.value=n)}function A(n,a){switch(n.keyCode){case 13:case 32:return b(a),p(n);case 37:case 40:return x[`rt${a-1}`]&&x[`rt${a-1}`].focus(),p(n);case 39:case 38:return x[`rt${a+1}`]&&x[`rt${a+1}`].focus(),p(n)}}function L(){d.value=0}return _e(()=>{x={}}),()=>{const n=[];return D.value.forEach(({iconClass:a,name:_,attrs:q},B)=>{const t=B+1;n.push(Q("div",{key:t,ref:w=>{x[`rt${t}`]=w},class:"q-rating__icon-container flex flex-center",...q,onClick(){b(t)},onMouseover(){r(t)},onMouseout:L,onFocus(){r(t)},onBlur:L,onKeyup(w){A(w,t)}},Ce(m[`tip-${t}`],[Q(Ve,{class:a,name:_})])))}),e.name!==void 0&&e.disable!==!0&&u(n,"push"),Q("div",{class:y.value,style:S.value,...c.value},n)}}}),Ge={class:"absolute-bottom text-subtitle4 text-center"},Je={key:2,class:"text-caption text-grey text-center"},We={class:"row items-center"},pe={class:"col text-h6 ellipsis"},Xe={class:"text-subtitle1"},Ye={class:"text-caption text-grey",style:{height:"60px",overflow:"auto","white-space":"pre-line"}},Ze={__name:"ProductCard",props:{product:Object},setup(e){const m=M(0),f=M(3),s=Ae(),S=ue(),v=async()=>{try{const{data:u}=await Be.cart({product:e.product._id,quantity:1});s.cartTotal=u.result,S.notify({type:"positive",message:"已加入購物車"})}catch(u){console.error("Error fetching products:",u),S.notify({type:"negative",message:"無法加入購物車"})}};return(u,d)=>{const x=Le("router-link");return V(),j(qe,{flat:"",bordered:""},{default:h(()=>[g(X,null,{default:h(()=>[e.product.images.length>1?(V(),j(Oe,{key:0,autoplay:!1,arrows:!0,infinite:!0,height:"300px",swipeable:"",class:"rounded-borders",modelValue:m.value,"onUpdate:modelValue":d[0]||(d[0]=k=>m.value=k),"control-type":"outline","control-color":"purple"},{default:h(()=>[(V(!0),H(G,null,J(e.product.images,(k,y)=>(V(),j(Te,{key:y,name:y,"img-src":k,style:{"background-size":"cover","background-position":"center"}},{default:h(()=>[C("div",Ge,I(e.product.name)+" - "+I(y+1),1)]),_:2},1032,["name","img-src"]))),128))]),_:1},8,["modelValue"])):e.product.images.length===1?(V(),j(Ue,{key:1,src:e.product.images[0],height:"300px",fit:"contain"},null,8,["src"])):(V(),H("div",Je,"無商品圖片"))]),_:1}),g(te),g(X,null,{default:h(()=>[C("div",We,[C("div",pe,[g(x,{to:"/product/"+e.product._id},{default:h(()=>[K(I(e.product.name),1)]),_:1},8,["to"])]),e.product.category?(V(),j(ae,{key:0,class:"q-ml-sm",color:"primary",label:e.product.category,outline:""},null,8,["label"])):we("",!0),g(ae,{color:"orange",class:"q-ml-sm"},{default:h(()=>[K(" 已售 "+I(e.product.sold||0),1)]),_:1})]),g(Re,{modelValue:f.value,"onUpdate:modelValue":d[1]||(d[1]=k=>f.value=k),max:5,readonly:"",size:"32px",color:"yellow",icon:"star_border","icon-selected":"star","icon-half":"star_half","no-dimming":""},null,8,["modelValue"])]),_:1}),g(X,{class:"q-pt-none"},{default:h(()=>[C("div",Xe,"$"+I(e.product.price),1),C("div",Ye,I(e.product.description),1)]),_:1}),g(te),g($e,{class:"justify-end"},{default:h(()=>[g(W,{outline:"",icon:"favorite",color:"red"}),g(W,{outline:"",icon:"add_shopping_cart",color:"primary",onClick:v},{default:h(()=>d[2]||(d[2]=[K(" 加入購物車 ",-1)])),_:1,__:[2]})]),_:1})]),_:1})}}},et={class:"row full-width q-mb-lg"},tt={class:"col-12"},at={class:"col-12"},lt={class:"row justify-between items-center"},nt={class:"col-auto"},ot={class:"col-auto"},it={class:"row"},rt={class:"row justify-center bg-grey-2 q-pa-md"},Y=12,xt={__name:"ShoppingPage",setup(e){const m=ue(),f=M([]),s=M(""),S=Ie({電子產品:!1,服裝:!1,家居用品:!1,書籍:!1,玩具:!1,食品:!1,其他:!1}),v=i(()=>Object.keys(S).filter(c=>S[c])),u=i(()=>f.value.filter(c=>{const b=!s.value||c.name.toLowerCase().includes(s.value.toLowerCase()),r=v.value.length===0||v.value.includes(c.category);return b&&r}).sort((c,b)=>{const r=x[d.value];return r.key==="createdAt"||r.key==="updatedAt"?r.direction*(new Date(c[r.key])-new Date(b[r.key])):r.direction*(c[r.key]>b[r.key]?1:-1)})),d=M(0),x=[{text:"名稱",key:"name",direction:1},{text:"價格：低到高",key:"price",direction:1},{text:"價格：高到低",key:"price",direction:-1},{text:"最新商品",key:"createdAt",direction:-1},{text:"最舊商品",key:"createdAt",direction:1}],k=c=>{d.value=c,y.value=1},y=M(1),O=i(()=>Math.ceil(u.value.length/Y)),F=i(()=>{const c=(y.value-1)*Y,b=c+Y;return u.value.slice(c,b)});return(async()=>{try{const{data:c}=await He.get();f.value=c.products}catch(c){console.error("Error fetching products:",c),m.notify({type:"negative",message:"無法載入商品資料"})}})(),(c,b)=>(V(),j(je,{class:"flex q-ma-xl column"},{default:h(()=>[C("div",et,[C("div",tt,[g(re,{modelValue:s.value,"onUpdate:modelValue":[b[0]||(b[0]=r=>s.value=r),b[1]||(b[1]=r=>y.value=1)],deleteable:"",label:"搜尋商品"},null,8,["modelValue"])]),C("div",at,[C("div",lt,[C("div",nt,[(V(!0),H(G,null,J(S,(r,A)=>(V(),j(Me,{key:A,label:A,outline:"",color:"primary",selected:S[A],"onUpdate:selected":[L=>S[A]=L,L=>{y.value=1}]},null,8,["label","selected","onUpdate:selected"]))),128))]),C("div",ot,[g(W,{color:"primary",flat:"","icon-right":"arrow_drop_down",ripple:!1,class:"q-ml-sm"},{default:h(()=>[K(I(x[d.value].text)+" ",1),g(Fe,{"transition-show":"jump-down","transition-hide":"jump-up"},{default:h(()=>[g(De,{style:{"min-width":"100px"}},{default:h(()=>[(V(),H(G,null,J(x,(r,A)=>Qe(g(Ee,{key:A,clickable:"",onClick:L=>k(A)},{default:h(()=>[g(Ne,null,{default:h(()=>[K(I(r.text),1)]),_:2},1024)]),_:2},1032,["onClick"]),[[Ke]])),64))]),_:1})]),_:1})]),_:1})])])])]),C("div",it,[(V(!0),H(G,null,J(F.value,r=>(V(),H("div",{class:"col-12 col-sm-6 col-md-4 col-lg-3 q-pa-sm",key:r.id},[g(Ze,{product:r},null,8,["product"])]))),128))]),C("div",rt,[g(ze,{modelValue:y.value,"onUpdate:modelValue":b[2]||(b[2]=r=>y.value=r),max:O.value,color:"primary","boundary-links":""},null,8,["modelValue","max"])])]),_:1}))}};export{xt as default};
