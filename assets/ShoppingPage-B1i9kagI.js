import{P as ne,ag as se,ah as de,g as oe,ai as me,c as i,r as M,w as ve,aj as ee,ak as fe,K as ie,h as Q,a5 as re,a7 as W,al as ge,am as ye,an as be,ao as he,ap as Se,aq as xe,ar as ke,as as _e,J as Ce,Q as Ve,at as Pe,M as X,a2 as Ae,a3 as ue,t as Le,z as N,m as V,B as S,f as g,au as Y,l as H,F as G,A as J,q as C,u as B,av as te,p as we,a8 as K,aw as $e,ax as qe,a4 as Ie,ay as Be,I as Qe}from"./index-B461q1Ze.js";import{Q as Me}from"./QChip-BsDxS4OK.js";import{Q as Fe,a as je,b as De}from"./QList-DGGuewng.js";import{Q as Ee}from"./QMenu-ACvhqup6.js";import{b as ce}from"./format-BvkBI9bc.js";import{Q as Ne}from"./QPage-D0xsif_d.js";import{p as He}from"./product-DFEQJdvc.js";import{Q as Oe,a as Te}from"./QCarousel-MUj-D7f9.js";import{Q as Ue}from"./QImg-CQuAMECl.js";import{Q as ae}from"./QBadge-CGfD7txH.js";import"./position-engine-ChCOnJ3m.js";import"./selection-BYe2XIGp.js";import"./touch-BjYP5sR0.js";import"./use-fullscreen-CCGQSgNU.js";function R(e,m){return[!0,!1].includes(e)?e:m}const ze=ne({name:"QPagination",props:{...de,modelValue:{type:Number,required:!0},min:{type:[Number,String],default:1},max:{type:[Number,String],required:!0},maxPages:{type:[Number,String],default:0,validator:e=>(typeof e=="string"?parseInt(e,10):e)>=0},inputStyle:[Array,String,Object],inputClass:[Array,String,Object],size:String,disable:Boolean,input:Boolean,iconPrev:String,iconNext:String,iconFirst:String,iconLast:String,toFn:Function,boundaryLinks:{type:Boolean,default:null},boundaryNumbers:{type:Boolean,default:null},directionLinks:{type:Boolean,default:null},ellipses:{type:Boolean,default:null},ripple:{type:[Boolean,Object],default:null},round:Boolean,rounded:Boolean,flat:Boolean,outline:Boolean,unelevated:Boolean,push:Boolean,glossy:Boolean,color:{type:String,default:"primary"},textColor:String,activeDesign:{type:String,default:"",values:e=>e===""||se.includes(e)},activeColor:String,activeTextColor:String,gutter:String,padding:{type:String,default:"3px 2px"}},emits:["update:modelValue"],setup(e,{emit:m}){const{proxy:f}=oe(),{$q:u}=f,h=me(e,u),v=i(()=>parseInt(e.min,10)),c=i(()=>parseInt(e.max,10)),d=i(()=>parseInt(e.maxPages,10)),x=i(()=>s.value+" / "+c.value),k=i(()=>R(e.boundaryLinks,e.input)),y=i(()=>R(e.boundaryNumbers,!e.input)),O=i(()=>R(e.directionLinks,e.input)),F=i(()=>R(e.ellipses,!e.input)),j=M(null),s=i({get:()=>e.modelValue,set:l=>{if(l=parseInt(l,10),e.disable||isNaN(l))return;const o=ce(l,v.value,c.value);e.modelValue!==o&&m("update:modelValue",o)}});ve(()=>`${v.value}|${c.value}`,()=>{s.value=e.modelValue});const b=i(()=>"q-pagination row no-wrap items-center"+(e.disable===!0?" disabled":"")),r=i(()=>e.gutter in ee?`${ee[e.gutter]}px`:e.gutter||null),A=i(()=>r.value!==null?`--q-pagination-gutter-parent:-${r.value};--q-pagination-gutter-child:${r.value}`:null),L=i(()=>{const l=[e.iconFirst||u.iconSet.pagination.first,e.iconPrev||u.iconSet.pagination.prev,e.iconNext||u.iconSet.pagination.next,e.iconLast||u.iconSet.pagination.last];return u.lang.rtl===!0?l.reverse():l}),n=i(()=>({"aria-disabled":e.disable===!0?"true":"false",role:"navigation"})),a=i(()=>fe(e,"flat")),_=i(()=>({[a.value]:!0,round:e.round,rounded:e.rounded,padding:e.padding,color:e.color,textColor:e.textColor,size:e.size,ripple:e.ripple!==null?e.ripple:!0})),q=i(()=>{const l={[a.value]:!1};return e.activeDesign!==""&&(l[e.activeDesign]=!0),l}),I=i(()=>({...q.value,color:e.activeColor||e.color,textColor:e.activeTextColor||e.textColor})),t=i(()=>{let l=Math.max(d.value,1+(F.value?2:0)+(y.value?2:0));const o={pgFrom:v.value,pgTo:c.value,ellipsesStart:!1,ellipsesEnd:!1,boundaryStart:!1,boundaryEnd:!1,marginalStyle:{minWidth:`${Math.max(2,String(c.value).length)}em`}};return d.value&&l<c.value-v.value+1&&(l=1+Math.floor(l/2)*2,o.pgFrom=Math.max(v.value,Math.min(c.value-l+1,e.modelValue-Math.floor(l/2))),o.pgTo=Math.min(c.value,o.pgFrom+l-1),y.value&&(o.boundaryStart=!0,o.pgFrom++),F.value&&o.pgFrom>v.value+(y.value?1:0)&&(o.ellipsesStart=!0,o.pgFrom++),y.value&&(o.boundaryEnd=!0,o.pgTo--),F.value&&o.pgTo<c.value-(y.value?1:0)&&(o.ellipsesEnd=!0,o.pgTo--)),o});function w(l){s.value=l}function D(l){s.value=s.value+l}const T=i(()=>{function l(){s.value=j.value,j.value=null}return{"onUpdate:modelValue":o=>{j.value=o},onKeyup:o=>{ie(o,13)===!0&&l()},onBlur:l}});function P(l,o,U){const E={"aria-label":o,"aria-current":"false",..._.value,...l};return U===!0&&Object.assign(E,{"aria-current":"true",...I.value}),o!==void 0&&(e.toFn!==void 0?E.to=e.toFn(o):E.onClick=()=>{w(o)}),Q(W,E)}return Object.assign(f,{set:w,setByOffset:D}),()=>{const l=[],o=[];let U;if(k.value===!0&&(l.push(P({key:"bls",disable:e.disable||e.modelValue<=v.value,icon:L.value[0],"aria-label":u.lang.pagination.first},v.value)),o.unshift(P({key:"ble",disable:e.disable||e.modelValue>=c.value,icon:L.value[3],"aria-label":u.lang.pagination.last},c.value))),O.value===!0&&(l.push(P({key:"bdp",disable:e.disable||e.modelValue<=v.value,icon:L.value[1],"aria-label":u.lang.pagination.prev},e.modelValue-1)),o.unshift(P({key:"bdn",disable:e.disable||e.modelValue>=c.value,icon:L.value[2],"aria-label":u.lang.pagination.next},e.modelValue+1))),e.input!==!0){U=[];const{pgFrom:E,pgTo:p,marginalStyle:z}=t.value;if(t.value.boundaryStart===!0){const $=v.value===e.modelValue;l.push(P({key:"bns",style:z,disable:e.disable,label:v.value},v.value,$))}if(t.value.boundaryEnd===!0){const $=c.value===e.modelValue;o.unshift(P({key:"bne",style:z,disable:e.disable,label:c.value},c.value,$))}t.value.ellipsesStart===!0&&l.push(P({key:"bes",style:z,disable:e.disable,label:"…",ripple:!1},E-1)),t.value.ellipsesEnd===!0&&o.unshift(P({key:"bee",style:z,disable:e.disable,label:"…",ripple:!1},p+1));for(let $=E;$<=p;$++)U.push(P({key:`bpg${$}`,style:z,disable:e.disable,label:$},$,$===e.modelValue))}return Q("div",{class:b.value,...n.value},[Q("div",{class:"q-pagination__content row no-wrap items-center",style:A.value},[...l,e.input===!0?Q(re,{class:"inline",style:{width:`${x.value.length/1.5}em`},type:"number",dense:!0,value:j.value,disable:e.disable,dark:h.value,borderless:!0,inputClass:e.inputClass,inputStyle:e.inputStyle,placeholder:x.value,min:v.value,max:c.value,...T.value}):Q("div",{class:"q-pagination__middle row justify-center"},U),...o])])}}});function le(e){if(e===!1)return 0;if(e===!0||e===void 0)return 1;const m=parseInt(e,10);return isNaN(m)?0:m}const Ke=ge({name:"close-popup",beforeMount(e,{value:m}){const f={depth:le(m),handler(u){f.depth!==0&&setTimeout(()=>{const h=ye(e);h!==void 0&&be(h,u,f.depth)})},handlerKey(u){ie(u,13)===!0&&f.handler(u)}};e.__qclosepopup=f,e.addEventListener("click",f.handler),e.addEventListener("keyup",f.handlerKey)},updated(e,{value:m,oldValue:f}){m!==f&&(e.__qclosepopup.depth=le(m))},beforeUnmount(e){const m=e.__qclosepopup;e.removeEventListener("click",m.handler),e.removeEventListener("keyup",m.handlerKey),delete e.__qclosepopup}}),Re=ne({name:"QRating",props:{...Se,...he,modelValue:{type:Number,required:!0},max:{type:[String,Number],default:5},icon:[String,Array],iconHalf:[String,Array],iconSelected:[String,Array],iconAriaLabel:[String,Array],color:[String,Array],colorHalf:[String,Array],colorSelected:[String,Array],noReset:Boolean,noDimming:Boolean,readonly:Boolean,disable:Boolean},emits:["update:modelValue"],setup(e,{slots:m,emit:f}){const{proxy:{$q:u}}=oe(),h=xe(e),v=ke(e),c=Pe(v),d=M(0);let x={};const k=i(()=>e.readonly!==!0&&e.disable!==!0),y=i(()=>`q-rating row inline items-center q-rating--${k.value===!0?"":"non-"}editable`+(e.noDimming===!0?" q-rating--no-dimming":"")+(e.disable===!0?" disabled":"")+(e.color!==void 0&&Array.isArray(e.color)===!1?` text-${e.color}`:"")),O=i(()=>{const n=Array.isArray(e.icon)===!0?e.icon.length:0,a=Array.isArray(e.iconSelected)===!0?e.iconSelected.length:0,_=Array.isArray(e.iconHalf)===!0?e.iconHalf.length:0,q=Array.isArray(e.color)===!0?e.color.length:0,I=Array.isArray(e.colorSelected)===!0?e.colorSelected.length:0,t=Array.isArray(e.colorHalf)===!0?e.colorHalf.length:0;return{iconLen:n,icon:n>0?e.icon[n-1]:e.icon,selIconLen:a,selIcon:a>0?e.iconSelected[a-1]:e.iconSelected,halfIconLen:_,halfIcon:_>0?e.iconHalf[a-1]:e.iconHalf,colorLen:q,color:q>0?e.color[q-1]:e.color,selColorLen:I,selColor:I>0?e.colorSelected[I-1]:e.colorSelected,halfColorLen:t,halfColor:t>0?e.colorHalf[t-1]:e.colorHalf}}),F=i(()=>{if(typeof e.iconAriaLabel=="string"){const n=e.iconAriaLabel.length!==0?`${e.iconAriaLabel} `:"";return a=>`${n}${a}`}if(Array.isArray(e.iconAriaLabel)===!0){const n=e.iconAriaLabel.length;if(n>0)return a=>e.iconAriaLabel[Math.min(a,n)-1]}return(n,a)=>`${a} ${n}`}),j=i(()=>{const n=[],a=O.value,_=Math.ceil(e.modelValue),q=k.value===!0?0:null,I=e.iconHalf===void 0||_===e.modelValue?-1:_;for(let t=1;t<=e.max;t++){const w=d.value===0&&e.modelValue>=t||d.value>0&&d.value>=t,D=I===t&&d.value<t,T=d.value>0&&(D===!0?_:e.modelValue)>=t&&d.value<t,P=D===!0?t<=a.halfColorLen?e.colorHalf[t-1]:a.halfColor:a.selColor!==void 0&&w===!0?t<=a.selColorLen?e.colorSelected[t-1]:a.selColor:t<=a.colorLen?e.color[t-1]:a.color,l=(D===!0?t<=a.halfIconLen?e.iconHalf[t-1]:a.halfIcon:a.selIcon!==void 0&&(w===!0||T===!0)?t<=a.selIconLen?e.iconSelected[t-1]:a.selIcon:t<=a.iconLen?e.icon[t-1]:a.icon)||u.iconSet.rating.icon;n.push({name:(D===!0?t<=a.halfIconLen?e.iconHalf[t-1]:a.halfIcon:a.selIcon!==void 0&&(w===!0||T===!0)?t<=a.selIconLen?e.iconSelected[t-1]:a.selIcon:t<=a.iconLen?e.icon[t-1]:a.icon)||u.iconSet.rating.icon,attrs:{tabindex:q,role:"radio","aria-checked":e.modelValue===t?"true":"false","aria-label":F.value(t,l)},iconClass:"q-rating__icon"+(w===!0||D===!0?" q-rating__icon--active":"")+(T===!0?" q-rating__icon--exselected":"")+(d.value===t?" q-rating__icon--hovered":"")+(P!==void 0?` text-${P}`:"")})}return n}),s=i(()=>{const n={role:"radiogroup"};return e.disable===!0&&(n["aria-disabled"]="true"),e.readonly===!0&&(n["aria-readonly"]="true"),n});function b(n){if(k.value===!0){const a=ce(parseInt(n,10),1,parseInt(e.max,10)),_=e.noReset!==!0&&e.modelValue===a?0:a;_!==e.modelValue&&f("update:modelValue",_),d.value=0}}function r(n){k.value===!0&&(d.value=n)}function A(n,a){switch(n.keyCode){case 13:case 32:return b(a),X(n);case 37:case 40:return x[`rt${a-1}`]&&x[`rt${a-1}`].focus(),X(n);case 39:case 38:return x[`rt${a+1}`]&&x[`rt${a+1}`].focus(),X(n)}}function L(){d.value=0}return _e(()=>{x={}}),()=>{const n=[];return j.value.forEach(({iconClass:a,name:_,attrs:q},I)=>{const t=I+1;n.push(Q("div",{key:t,ref:w=>{x[`rt${t}`]=w},class:"q-rating__icon-container flex flex-center",...q,onClick(){b(t)},onMouseover(){r(t)},onMouseout:L,onFocus(){r(t)},onBlur:L,onKeyup(w){A(w,t)}},Ce(m[`tip-${t}`],[Q(Ve,{class:a,name:_})])))}),e.name!==void 0&&e.disable!==!0&&c(n,"push"),Q("div",{class:y.value,style:h.value,...s.value},n)}}}),Ge={class:"absolute-bottom text-subtitle4 text-center"},Je={key:2,class:"text-caption text-grey text-center"},We={class:"row items-center"},Xe={class:"col text-h6 ellipsis"},Ye={class:"text-subtitle1"},Ze={class:"text-caption text-grey",style:{height:"60px",overflow:"auto","white-space":"pre-line"}},pe={__name:"ProductCard",props:{product:Object},setup(e){const m=M(0),f=M(3),u=Ae(),h=ue(),v=async()=>{if(!u.isLoggedIn){h.dialog({title:"需要登入",message:"請先登入帳號才能加入購物車"});return}try{const{data:c}=await Ie.cart({product:e.product._id,quantity:1});u.cartTotal=c.result,h.notify({type:"positive",message:"已加入購物車"})}catch(c){console.error("Error fetching products:",c),h.notify({type:"negative",message:"無法加入購物車，請稍後再試"})}};return(c,d)=>{const x=Le("router-link");return V(),N(qe,{flat:"",bordered:""},{default:S(()=>[g(Y,null,{default:S(()=>[e.product.images.length>1?(V(),N(Oe,{key:0,autoplay:!1,arrows:!0,infinite:!0,height:"300px",swipeable:"",class:"rounded-borders",modelValue:m.value,"onUpdate:modelValue":d[0]||(d[0]=k=>m.value=k),"control-type":"outline","control-color":"purple"},{default:S(()=>[(V(!0),H(G,null,J(e.product.images,(k,y)=>(V(),N(Te,{key:y,name:y,"img-src":k,style:{"background-size":"cover","background-position":"center"}},{default:S(()=>[C("div",Ge,B(e.product.name)+" - "+B(y+1),1)]),_:2},1032,["name","img-src"]))),128))]),_:1},8,["modelValue"])):e.product.images.length===1?(V(),N(Ue,{key:1,src:e.product.images[0],height:"300px",fit:"contain"},null,8,["src"])):(V(),H("div",Je,"無商品圖片"))]),_:1}),g(te),g(Y,null,{default:S(()=>[C("div",We,[C("div",Xe,[g(x,{to:"/product/"+e.product._id},{default:S(()=>[K(B(e.product.name),1)]),_:1},8,["to"])]),e.product.category?(V(),N(ae,{key:0,class:"q-ml-sm",color:"primary",label:e.product.category,outline:""},null,8,["label"])):we("",!0),g(ae,{color:"orange",class:"q-ml-sm"},{default:S(()=>[K(" 已售 "+B(e.product.sold||0),1)]),_:1})]),g(Re,{modelValue:f.value,"onUpdate:modelValue":d[1]||(d[1]=k=>f.value=k),max:5,readonly:"",size:"32px",color:"yellow",icon:"star_border","icon-selected":"star","icon-half":"star_half","no-dimming":""},null,8,["modelValue"])]),_:1}),g(Y,{class:"q-pt-none"},{default:S(()=>[C("div",Ye,"$"+B(e.product.price),1),C("div",Ze,B(e.product.description),1)]),_:1}),g(te),g($e,{class:"justify-end"},{default:S(()=>[g(W,{outline:"",icon:"favorite",color:"red"}),g(W,{outline:"",icon:"add_shopping_cart",color:"primary",onClick:v},{default:S(()=>d[2]||(d[2]=[K(" 加入購物車 ",-1)])),_:1,__:[2]})]),_:1})]),_:1})}}},et={class:"row full-width q-mb-lg"},tt={class:"col-12"},at={class:"col-12"},lt={class:"row justify-between items-center"},nt={class:"col-auto"},ot={class:"col-auto"},it={class:"row"},rt={class:"row justify-center bg-grey-2 q-pa-md"},Z=12,_t={__name:"ShoppingPage",setup(e){const m=ue(),f=M([]),u=M(""),h=Be({電子產品:!1,服裝:!1,家居用品:!1,書籍:!1,玩具:!1,食品:!1,其他:!1}),v=i(()=>Object.keys(h).filter(s=>h[s])),c=i(()=>f.value.filter(s=>{const b=!u.value||s.name.toLowerCase().includes(u.value.toLowerCase()),r=v.value.length===0||v.value.includes(s.category);return b&&r}).sort((s,b)=>{const r=x[d.value];return r.key==="createdAt"||r.key==="updatedAt"?r.direction*(new Date(s[r.key])-new Date(b[r.key])):r.direction*(s[r.key]>b[r.key]?1:-1)})),d=M(0),x=[{text:"名稱",key:"name",direction:1},{text:"價格：低到高",key:"price",direction:1},{text:"價格：高到低",key:"price",direction:-1},{text:"最新商品",key:"createdAt",direction:-1},{text:"最舊商品",key:"createdAt",direction:1}],k=s=>{d.value=s,y.value=1},y=M(1),O=i(()=>Math.ceil(c.value.length/Z)),F=i(()=>{const s=(y.value-1)*Z,b=s+Z;return c.value.slice(s,b)});return(async()=>{try{const{data:s}=await He.get();f.value=s.products}catch(s){console.error("Error fetching products:",s),m.notify({type:"negative",message:"無法載入商品資料"})}})(),(s,b)=>(V(),N(Ne,{class:"flex q-ma-xl column"},{default:S(()=>[C("div",et,[C("div",tt,[g(re,{modelValue:u.value,"onUpdate:modelValue":[b[0]||(b[0]=r=>u.value=r),b[1]||(b[1]=r=>y.value=1)],deleteable:"",label:"搜尋商品"},null,8,["modelValue"])]),C("div",at,[C("div",lt,[C("div",nt,[(V(!0),H(G,null,J(h,(r,A)=>(V(),N(Me,{key:A,label:A,outline:"",color:"judy-4",selected:h[A],"onUpdate:selected":[L=>h[A]=L,L=>{y.value=1}]},null,8,["label","selected","onUpdate:selected"]))),128))]),C("div",ot,[g(W,{color:"judy-4",flat:"","icon-right":"arrow_drop_down",ripple:!1,class:"q-ml-sm"},{default:S(()=>[K(B(x[d.value].text)+" ",1),g(Ee,{"transition-show":"jump-down","transition-hide":"jump-up"},{default:S(()=>[g(Fe,{style:{"min-width":"100px"}},{default:S(()=>[(V(),H(G,null,J(x,(r,A)=>Qe(g(je,{key:A,clickable:"",onClick:L=>k(A)},{default:S(()=>[g(De,null,{default:S(()=>[K(B(r.text),1)]),_:2},1024)]),_:2},1032,["onClick"]),[[Ke]])),64))]),_:1})]),_:1})]),_:1})])])])]),C("div",it,[(V(!0),H(G,null,J(F.value,r=>(V(),H("div",{class:"col-12 col-sm-6 col-md-4 col-lg-3 q-pa-sm bg-grey-2",key:r.id},[g(pe,{product:r},null,8,["product"])]))),128))]),C("div",rt,[g(ze,{modelValue:y.value,"onUpdate:modelValue":b[2]||(b[2]=r=>y.value=r),max:O.value,color:"judy-4","boundary-links":""},null,8,["modelValue","max"])])]),_:1}))}};export{_t as default};
