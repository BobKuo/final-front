import{Q as l}from"./QItemLabel-Da9IXRyj.js";import{a1 as S,r as $,c as g,z as h,m as p,B as t,a3 as b,a2 as B,a0 as I,f as e,l as q,a8 as c,av as f,F as N,A as T,p as L,u as i,q as P,a4 as U,a6 as y}from"./index-DzpRqGnP.js";import{Q as V}from"./QImg-By2wL4pV.js";import{Q as D,a as x,b as n}from"./QList-C-TSOasy.js";import{Q as F}from"./QPage-CVbQiZ1R.js";import{o as z}from"./order-41Y5gx5S.js";const A={key:0,class:"absolute-bottom text-subtitle1 text-center"},E={class:"row q-mt-sm"},W={__name:"CartPage",setup(R){const d=B(),_=S(),Q=I(),o=$([]);(async()=>{try{const{data:a}=await b.getCart();o.value=a.result}catch(a){console.error(a),d.notify({type:"negative",message:"無法獲取購物車資料"})}})();const v=async(a,s,r)=>{if(a!=="")try{const{data:u}=await b.cart({product:s.product._id,quantity:a-s.quantity});s.quantity=a,a<=0&&o.value.splice(r,1),_.cartTotal=u.result}catch(u){console.error(u),d.notify({type:"negative",message:"更新購物車失敗"})}},k=g(()=>o.value.reduce((a,s)=>a+s.product.price*s.quantity,0)),C=g(()=>o.value.length===0),w=async()=>{if(o.value.some(a=>!a.product.sell)){d.notify({type:"negative",message:"購物車中有已下架商品，無法結帳"});return}try{await z.create(),_.cartTotal=0,o.value=[],d.notify({spinner:!0,type:"positive",timeout:1500,message:"結帳成功！ 將跳轉到訂單頁面"}),setTimeout(()=>{Q.push("/orders")},3e3)}catch(a){console.error(a),d.notify({type:"negative",message:"結帳失敗，請稍後再試！"})}};return(a,s)=>(p(),h(F,{class:"flex flex-center"},{default:t(()=>[e(D,{bordered:"",padding:"",separator:"",class:"shadow-2",style:{width:"80%"}},{default:t(()=>[e(l,{header:""},{default:t(()=>s[0]||(s[0]=[c("購物車",-1)])),_:1,__:[0]}),e(f),(p(!0),q(N,null,T(o.value,(r,u)=>(p(),h(x,{key:r._id,active:!r.product.sell,"active-class":"bg-grey-3"},{default:t(()=>[e(n,{top:"",class:"q-ml-none",style:{width:"200px",height:"150px"}},{default:t(()=>[e(V,{src:r.product.images[0],fit:"contain",style:{cursor:"pointer"},onClick:m=>a.$router.push("/product/"+r.product._id)},{default:t(()=>[r.product.sell?L("",!0):(p(),q("div",A," 已下架 "))]),_:2},1032,["src","onClick"])]),_:2},1024),e(f,{vertical:""}),e(n,null,{default:t(()=>[e(l,{class:"q-ml-md"},{default:t(()=>[c(i(r.product.name),1)]),_:2},1024),e(l,{caption:"",class:"text-center"},{default:t(()=>[c("價格: $"+i(r.product.price),1)]),_:2},1024)]),_:2},1024),e(f,{vertical:""}),e(n,{style:{height:"100px"}},{default:t(()=>[e(l,{caption:"",style:{overflow:"auto","white-space":"pre-line"}},{default:t(()=>[c(i(r.product.description),1)]),_:2},1024)]),_:2},1024),e(f,{vertical:""}),e(n,{side:""},{default:t(()=>[e(U,{"model-value":r.quantity,type:"number","input-class":"text-center",min:0,disable:!r.product.sell,outlined:"",square:"","onUpdate:modelValue":m=>v(m,r,u)},null,8,["model-value","disable","onUpdate:modelValue"]),P("div",E,[e(y,{icon:"favorite",color:"red",outline:"",dense:"",label:"移入"}),e(y,{icon:"delete",color:"secondary",outline:"",dense:"",label:"刪除",onClick:m=>v(0,r,u),class:"q-ml-md"},null,8,["onClick"])]),e(l,{class:"q-mt-md"},{default:t(()=>[c("項目總價: $"+i(r.product.price*r.quantity),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["active"]))),128)),e(x,null,{default:t(()=>[e(n,null,{default:t(()=>[e(l,{class:"text-right"},{default:t(()=>s[1]||(s[1]=[c("總計",-1)])),_:1,__:[1]}),e(l,{class:"text-right"},{default:t(()=>[c("$"+i(k.value),1)]),_:1})]),_:1}),e(n,{side:""},{default:t(()=>[e(y,{onClick:w,disable:C.value,label:"結帳",color:"primary",class:"full-width"},null,8,["disable"])]),_:1})]),_:1})]),_:1})]),_:1}))}};export{W as default};
